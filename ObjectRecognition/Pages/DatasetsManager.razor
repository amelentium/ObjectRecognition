@page "/datasets"

@using System.IO;
@using System.Web;
@using System.Collections;

@inject IWebHostEnvironment HostEnvironment;

<PageTitle>Datasets</PageTitle>

<h3>Dataset Manager</h3>
<div class="row">
    <div class="col-md-4" style="margin-bottom: 16px">
        <DatasetsTree DatasetsPath="@DatasetsPath"
                      OnDatasetChange="@DatasetChange" />
    </div>
    <div class="col-md-8" style="margin-bottom: 16px">
        <DatasetImageManager Images="@Images"/>
    </div>
</div>

@code {
    private const string DatasetsRootPath = "images\\data_sets";
    private string DatasetsPath;

    private List<string> Images = new List<string>();

    protected override void OnInitialized()
    {
        DatasetsPath = Path.Combine(HostEnvironment.WebRootPath, DatasetsRootPath);
    }

    private void DatasetChange(string selectedDataset)
    {
        LoadFiles(selectedDataset);
    }

    private void LoadFiles(string datasetName)
    {
        Images = new List<string>();

        if (!string.IsNullOrEmpty(datasetName))
        {
            try
            {
                var datasetPath = Path.Combine(DatasetsPath, datasetName);

                Images.AddRange(Directory.GetFiles(datasetPath)
                                .Select(x => x.Replace(HostEnvironment.WebRootPath, string.Empty)
                                ));
            }
            catch
            {
                Directory.CreateDirectory(DatasetsPath);
            }
        }
    }
}